# [2022下学期开学一周总结](https://github.com/HuJJ-NB/gitblog/issues/16)

> 暑假复工三天之后又摸鱼了

这周在看***计算机系统基础***，貌似内容都学过，慢慢看了一段时间，之后打算跳着看了。但是，这本书可以说拿来启蒙是本很不错的书，很多东西能联系起来很系统地阐述，有些思想也很深入，或者说一些概念在之前的学习中都已经在我的脑海里了，但是很难表达，书里的说法我认为很贴切。

书看了之后的计划大概是看***xv6***的源码，还有本***CSAPP***,这本太厚了，不知道什么时候能有勇气开始看。

这学期应该是要开始准备数学和英语了，然后就是啃啃操作系统啥的。课余的话，周一晚上就去社团打打拳，再抽一天去游一个小时泳，当然得再来一天晚上去和女朋友吃饭。

这周把操作系统课上的实验一二给提前做了，编译内核和添加系统调用，大一下跟这贾刚勇老师上科研实践的时候做过，这俩还是很快的，而且很容易，但是隔了这么久我读代码的能力和查资料的能力都上去了，大一时候搞不明白的东西现在都有了更深的理解。

添加系统调用号网上有两个办法，一个是在架构相关的目录下修改一个`.tbl`文件，一个是在`./include/uapi/asm-generic/unistd.h`中添加宏定义。我不确定两个文件的关联，我用的是后一种办法，因为我认为大部分系统调用的实现是可以做到架构无关的。

目前我对`unistd.h`这个文件的理解是一个Unix（uni）的标准库（std），定义了一些内核中的符号常量。而且，之后可以用`make headers && make headers_install INSTALL_HDR_PATH=/usr`命令将自定义构建的内核所提供的所有头文件安装到编译器默认使用的头文件的位置（`/usr/include`），这样一来，就可以直接通过`#include <unistd.h>`来包涵关于自定义系统调用函数的宏定义，进而用`__NR_`为前缀的宏定义来代替自定义的系统调用号。

此外，以`SYS_`为前缀的宏定义和以`__NR_`为前缀的作用一致，但目前不确定怎么产生这样的文件，这个头文件貌似是架构相关的。

目前对于构建内核的流程，大体上是用`make oldconfig`将可用的`.config`文件拷贝到源码根目录，再通过`make menuconfig`做一些自定义，之后`make -jx && make modules_install -jx INSTALL_MOD_STRIP=1 && make install`，若是有构件头文件库的需求，还需要`make headers -jx && make headers_install INSTALL_HDR_PATH=/usr`。

`INSTALL_MOD_STRIP=1`这个选项是对模块进行裁剪，排除不必要的模块，防止之后`make install`生成的镜像过大，启动过慢甚至无法启动。

`INSTALL_HDR_PATH=/usr`这个选项是定义库文件安装的位置。
